<!-- app/templates/day.html -->
{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <!-- NAVIGATION -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{{ prev_url }}" class="btn btn-outline-dark">Previous Day</a>
        <h1 class="display-5 fw-bold text-center">{{ title }}</h1>
        <a href="{{ next_url }}" class="btn btn-outline-dark">Next Day</a>
    </div>

    <!-- BREADCRUMBS -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb p-0 bg-transparent">
                <li class="breadcrumb-item">
                    <a href="{{ url_for('main.year_page', year=day_date.year) }}" class="text-dark fw-bold text-decoration-none">
                        {{ day_date.year }}
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{{ url_for('main.quarter_page', year=day_date.year, q_num=((day_date.month-1)//3)+1) }}" 
                    class="text-dark fw-bold text-decoration-none">
                        Q{{ ((day_date.month-1)//3)+1 }}
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{{ url_for('main.month_page', year=day_date.year, month=day_date.month) }}" 
                    class="text-dark fw-bold text-decoration-none">
                        {{ day_date.strftime('%B') }}
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{{ url_for('main.week_page', year=day_date.isocalendar()[0], week=day_date.isocalendar()[1]) }}" 
                    class="text-dark fw-bold text-decoration-none">
                        Week {{ day_date.isocalendar()[1] }}
                    </a>
                </li>
            </ol>
        </nav>

    <!-- PREP FOR THE DAY -->
    <div class="card border-light mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">Prep for the Day</h5>
        </div>
        <div class="card-body">
                    <textarea name="prep" class="form-control autosave" 
                    data-scope="day" data-year="{{ day_date.year }}" data-month="{{ day_date.month }}" data-day="{{ day_date.day }}" data-type="prep"   
                    rows="3" 
                    placeholder="What must I accomplish today?"></textarea>
        </div>
    </div>

    <!-- DAILY GOAL CARDS -->
    <h5 class="mb-3">Daily Goals</h5>
    {% set columns = [
        {'id': 'todo', 'label': 'To Do'},
        {'id': 'in_progress', 'label': 'In Progress'},
        {'id': 'blocked', 'label': 'Blocked'},
        {'id': 'done', 'label': 'Done'}
    ] %}

    {% with goals=daily_goals_grouped, columns=columns %}
        {% include 'kanban_board.html' %}
    {% endwith %}


<!-- 24-HOUR GRID: SCHEDULE + TASKS -->
    <div class="row mb-4">
        <!-- LEFT: 24-HOUR SCHEDULE (SPACED OUT) -->
    
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Schedule</h5>
                </div>
                <div class="card-body p-0" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-bordered table-sm mb-0">
                        <tbody>
                            {% for hour in range(0, 24) %}
                                {% set hour_12 = (hour % 12) or 12 %}
                                {% set am_pm = 'AM' if hour < 12 else 'PM' %}
                                {% set is_visible = 7 <= hour < 19 %}
                                <tr class="{% if not is_visible %}text-muted{% endif %}">
                                    <td class="text-center align-middle" style="width: 80px; font-weight: bold;">
                                        {{ '%02d'|format(hour_12) }}:00 {{ am_pm }}
                                    </td>
                                    <td class="p-2">
                                        <div class="events-list">
                                            {% for event in events_on_date(year, month, day) %}
                                                {% if event.start_time and event.start_time.hour == hour %}
                                                    <div class="event-badge bg-primary text-white p-1 mb-1 rounded small" data-event-id="{{ event.id }}" style="cursor: pointer;">
                                                        {{ event.title }}
                                                        {{ event.start_time.strftime('%H:%M') }}-{{ event.end_time.strftime('%H:%M') }}
                                                    </div>
                                                {% elif event.all_day and hour == 7 %}
                                                    <div class="event-badge bg-primary text-white p-1 mb-1 rounded small" data-event-id="{{ event.id }}"style="cursor: pointer;">
                                                        {{ event.title }} (All Day)
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <!-- + ADD EVENT IN EVERY SLOT -->
                                        <div class="add-event-area text-center text-muted small mt-1" 
                                            style="cursor: pointer;" 
                                            data-hour="{{ hour }}">
                                            + Add Event
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}                        
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    <!-- RIGHT: TASK CHECKLIST (SPACED OUT) -->
        <div class="col-md-6">
            <div class="card border-light h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Tasks</h5>
                </div>
                <div class="card-body p-0" style="height: 840px; overflow-y: auto;">
                    <div class="d-flex flex-column h-100">
                        {% for i in range(48) %}
                            <div class="border-bottom d-flex align-items-center px-3 py-1" style="height: 35px;">
                                <!--<input type="checkbox" class="me-3">-->
                                <input type="checkbox" class="task-complete" 
                                data-scope="day" data-year="{{ year }}" data-month="{{ month }}" 
                                data-day="{{ day }}" data-type="task" data-index="{{ i }}">

                                <input type="text" name="task" class="form-control autosave" 
                                    style="height: 100%; background: transparent; font-size: 0.9rem;"    
                                    placeholder="Task..."
                                    data-scope="day" data-year="{{ day_date.year }}" data-month="{{ day_date.month }}" 
                                    data-day="{{ day_date.day }}" data-type="task" data-index="{{ i }}">
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- NOTES — FULL WIDTH -->
    <div class="card border-light mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">Notes</h5>
        </div>
        <div class="card-body">
                    <textarea name="notes" class="form-control autosave" 
                    data-scope="day" data-year="{{ day_date.year }}" data-month="{{ day_date.month }}" data-day="{{ day_date.day }}" data-type="notes"  
                    rows="3" 
                    placeholder="Quick thoughts, reflections, blockers..."></textarea>
        </div>
    </div>

    <!-- REVIEW — TWO COLUMNS -->
    <div class="row">
        <div class="col-md-6">
            <div class="card border-success h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Wins, Successes, Accomplishments</h5>
                </div>
                <div class="card-body">
                    <textarea name="wins" class="form-control autosave" 
                    data-scope="day" data-year="{{ day_date.year }}" data-month="{{ day_date.month }}" data-day="{{ day_date.day }}" data-type="wins" 
                    rows="3" 
                    placeholder="What went well today?"></textarea>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-warning h-100">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">Areas to Improve</h5>
                </div>
                <div class="card-body">
                    <textarea name="improve" class="form-control autosave" 
                    data-scope="day" data-year="{{ day_date.year }}" data-month="{{ day_date.month }}" data-day="{{ day_date.day }}" data-type="improve" 
                    rows="3" 
                    placeholder="What could be better tomorrow?"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- EVENT MODAL -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="eventForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalLabel">Add Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="eventDate">
                    <input type="hidden" id="eventHour">
                    <div class="mb-3">
                        <label for="eventTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="col">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" required>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <label for="startTime" class="form-label">Start Time</label>
                            <input type="time" class="form-control" id="startTime">
                        </div>
                        <div class="col">
                            <label for="endTime" class="form-label">End Time</label>
                            <input type="time" class="form-control" id="endTime">
                        </div>
                    </div>
                    <div class="form-check mt-3">
                        <input type="checkbox" class="form-check-input" id="allDay">
                        <label class="form-check-label" for="allDay">All Day</label>
                    </div>
                    <div class="form-check mt-2">
                        <input type="checkbox" class="form-check-input" id="recurring">
                        <label class="form-check-label" for="recurring">Recurring</label>
                    </div>
                    <div id="recurrenceOptions" class="mt-2 d-none">
                        <select class="form-select" id="recurrenceRule">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Event</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
{% endblock %}