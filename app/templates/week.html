<!--app/templates/week.html-->
{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">


    <!-- PAGE NAVIGATION -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{{ prev_url }}" class="btn btn-outline-dark">Previous Week</a>
        <h1 class="display-5 fw-bold text-center">{{ title }}</h1>
        <a href="{{ next_url }}" class="btn btn-outline-dark">Next Week</a>
    </div>

    <!-- BREADCRUMBS -->
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb p-0 bg-transparent">
                    <li class="breadcrumb-item">
                        <a href="{{ url_for('main.year_page', year=year) }}" class="text-dark fw-bold text-decoration-none">
                            {{ year }}
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="{{ url_for('main.quarter_page', year=year, q_num=((sample_month-1)//3)+1) }}" 
                        class="text-dark fw-bold text-decoration-none">
                            Q{{ ((sample_month-1)//3)+1 }}
                        </a>
                    </li>
                    <li class="breadcrumb-item fw-bold" aria-current="page">
                        <a href="{{ url_for('main.month_page', year=year, month=month) }}" class="text-dark fw-bold text-decoration-none">
                            {{ month_name }}
                        </a>
                    </li>
                </ol>
            </nav>

    <!-- WEEKLY CALENDAR -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">Calendar</h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-bordered calendar-table mb-0">
                <thead class="table-light">
                    <tr>
                        <!--<th class="text-center bg-light" style="width: 60px; font-weight: bold;">Week</th>-->
                        {% for day in ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'] %}
                            <th class="text-center">{{ day }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <!-- WEEK NUMBER -->
                       <!-- <td class="text-center align-middle bg-light">
                            <a href="{{ url_for('main.week_page', year=year, week=week) }}" class="text-dark text-decoration-none">
                                <strong>W{{ week }}</strong>
                            </a>
                        </td> -->
                        <!-- 7 DAYS -->
                        {% for day_date in weeks[0].days %}
                            <td class="calendar-day position-relative" {% if day_date %}data-date="{{ day_date.strftime('%Y-%m-%d') }}"{% endif %}>
                                {% if day_date %}
                                    <div class="day-number fw-bold">
                                        <a href="{{ url_for('main.day_page', year=day_date.year, month=day_date.month, day=day_date.day) }}" class="text-dark text-decoration-none">
                                            {{ day_date.day }}
                                        </a>
                                    </div>
                                    <div class="events-list mt-1">
                                        {% for event in events_on_date(day_date.year, day_date.month, day_date.day) %}
                                            <div class="event-badge bg-primary text-white p-1 mb-1 rounded small" 
                                                data-event-id="{{ event.id }}" style="cursor: pointer;">
                                                {{ event.title }}
                                                {% if event.start_time %}
                                                    {{ event.start_time.strftime('%H:%M') }}-{{ event.end_time.strftime('%H:%M') }}
                                                {% endif %}
                                            </div>                                        
                                        {% endfor %}
                                    </div>
                                    <div class="add-event-area text-center text-primary small mt-2 fw-medium" 
                                        style="cursor: pointer; font-size: 0.85em; opacity: 0.7;">
                                        + Add Event
                                    </div>
                                {% else %}
                                    <div class="text-muted small">—</div>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- PREP FOR THE WEEK -->
    <div class="card border-light mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">Prep for the Week</h5>
        </div>
        <div class="card-body">
                    <textarea name="prep" class="form-control autosave" 
                    data-scope="week" data-year="{{ year }}" data-week="{{ week }}" data-type="prep" 
                    rows="5" 
                    placeholder="At the end of this week, what will my world look like? How will I get there?"></textarea>
        </div>
    </div>

    <!-- WEEKLY GOAL CARDS — FULL WIDTH -->
    <h5 class="mb-3">Weekly Goals</h5>
    {% set columns = [
        {'id': 'todo', 'label': 'To Do'},
        {'id': 'in_progress', 'label': 'In Progress'},
        {'id': 'blocked', 'label': 'Blocked'},
        {'id': 'done', 'label': 'Done'}
    ] %}

    {% with goals=weekly_goals_grouped, columns=columns %}
        {% include 'kanban_board.html' %}
    {% endwith %}

    <!-- NOTES -->
    <div class="card border-light mt-5">
        <div class="card-header bg-light">
            <h5 class="mb-0">Notes</h5>
        </div>
        <div class="card-body">
                    <textarea name="notes" class="form-control autosave" 
                    data-scope="week" data-year="{{ year }}" data-week="{{ week }}" data-type="notes" 
                    rows="4" 
                    placeholder="Jot down thoughts, ideas, blockers..."></textarea>
        </div>
    </div>

    <!-- REVIEW -->
    <div class="row mt-5">
        <div class="col-md-6">
            <div class="card border-success h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Wins, Successes, Accomplishments</h5>
                </div>
                <div class="card-body">
                    <textarea name="wins" class="form-control autosave" 
                    data-scope="week" data-year="{{ year }}" data-week="{{ week }}" data-type="wins"   
                    rows="4" 
                    placeholder="What went well?"></textarea>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-warning h-100">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">Areas to Improve</h5>
                </div>
                <div class="card-body">
                    <textarea name="improve" class="form-control autosave" 
                    data-scope="week" data-year="{{ year }}" data-week="{{ week }}" data-type="improve" 
                    rows="4" 
                    placeholder="What could be better?"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- EVENT MODAL — SAME AS MONTH -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="eventForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalLabel">Add Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="eventDate">
                    <div class="mb-3">
                        <label for="eventTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="col">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" required>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <label for="startTime" class="form-label">Start Time</label>
                            <input type="time" class="form-control" id="startTime">
                        </div>
                        <div class="col">
                            <label for="endTime" class="form-label">End Time</label>
                            <input type="time" class="form-control" id="endTime">
                        </div>
                    </div>
                    <div class="form-check mt-3">
                        <input type="checkbox" class="form-check-input" id="allDay">
                        <label class="form-check-label" for="allDay">All Day</label>
                    </div>
                    <div class="form-check mt-2">
                        <input type="checkbox" class="form-check-input" id="recurring">
                        <label class="form-check-label" for="recurring">Recurring</label>
                    </div>
                    <div id="recurrenceOptions" class="mt-2 d-none">
                        <select class="form-select" id="recurrenceRule">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Event</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}