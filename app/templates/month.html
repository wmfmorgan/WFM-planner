{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4">
    <!-- NAVIGATION -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{{ prev_url }}" class="btn btn-outline-dark">Previous Month</a>
        <h1 class="display-5 fw-bold text-center">{{ title }}</h1>
        <a href="{{ next_url }}" class="btn btn-outline-dark">Next Month</a>
    </div>

    <!-- BREADCRUMBS -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
            <li class="breadcrumb-item">
                <a href="{{ url_for('main.year_page', year=year) }}" 
                class="text-dark fw-bold text-decoration-none">
                    {{ year }}
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{{ url_for('main.quarter_page', year=year, q_num=((month-1)//3)+1) }}" 
                class="text-dark fw-bold text-decoration-none">Q{{ ((month-1)//3)+1 }}
                </a>
            </li>
        </ol>
    </nav>

    <div class="row">
        <!-- LEFT SIDEBAR: PREP, NOTES, WINS, REVIEW -->
        <div class="col-lg-3">
            <div class="card mb-3">
                <div class="card-header">Prep</div>
                <div class="card-body">
                    <textarea class="form-control autosave" rows="3" data-scope="month" data-year="{{ year }}" data-month="{{ month }}" data-type="prep"></textarea>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-header">Notes</div>
                <div class="card-body">
                    <textarea class="form-control autosave" rows="3" data-scope="month" data-year="{{ year }}" data-month="{{ month }}" data-type="notes"></textarea>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-header">Wins</div>
                <div class="card-body">
                    <textarea class="form-control autosave" rows="3" data-scope="month" data-year="{{ year }}" data-month="{{ month }}" data-type="wins"></textarea>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-header">Review</div>
                <div class="card-body">
                    <textarea class="form-control autosave" rows="3" data-scope="month" data-year="{{ year }}" data-month="{{ month }}" data-type="review"></textarea>
                </div>
            </div>
        </div>

        <!-- RIGHT: CALENDAR -->
        <div class="col-lg-9">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>{{ month_name }} {{ year }}</h5>
                  <!--  <div>
                        <a href="{{ url_for('main.month_page', year=year, month=month-1 if month > 1 else 12, _anchor='calendar') }}" class="btn btn-sm btn-outline-secondary">‹ Prev</a>
                        <a href="{{ url_for('main.month_page', year=year, month=month+1 if month < 12 else 1, _anchor='calendar') }}" class="btn btn-sm btn-outline-secondary">Next ›</a>
                    </div> -->
                </div>
                <div class="card-body p-0">
                    <table class="table table-bordered calendar-table">
                        <thead class="table-light">
                            <tr>
                                <th class="text-center bg-light" style="width: 60px; font-weight: bold;">Week</th>
                                {% for day in ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'] %}
                                    <th class="text-center">{{ day }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for week_num, week in calendar_with_weeks %}
                                <tr>
                                    <!-- WEEK NUMBER COLUMN -->
                                    <td class="text-center align-middle bg-light" style="cursor: pointer;">
                                        <a href="{{ url_for('main.week_page', year=year, week=week_num) }}" class="text-dark text-decoration-none">
                                            <strong>W{{ week_num }}</strong>
                                        </a>
                                    </td>
                                    <!-- DAYS -->
                                    {% for day in week %}
                                        <td class="calendar-day position-relative {% if day == 0 %}text-muted{% endif %}"
                                            {% if day != 0 %}data-date="{{ year }}-{{ '%02d'|format(month) }}-{{ '%02d'|format(day) }}"{% endif %}>
                                            {% if day != 0 %}
                                                <div class="day-number fw-bold">
                                                    <a href="{{ url_for('main.day_page', year=year, month=month, day=day) }}" class="text-dark text-decoration-none">
                                                        {{ day }}
                                                    </a>
                                                </div>
                                                <div class="events-list mt-1">
                                                    {% for event in events_on_date(year, month, day) %}
                                                        <div class="event-badge bg-primary text-white p-1 mb-1 rounded small text-truncate">
                                                            {{ event.title }}
                                                            {% if event.start_time %}
                                                                {{ event.start_time.strftime('%H:%M') }}-{{ event.end_time.strftime('%H:%M') }}
                                                            {% endif %}
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                                <div class="add-event-area text-center text-muted small mt-2" style="cursor: pointer; font-size: 0.8em;">
                                                    + Add Event
                                                </div>
                                            {% endif %}
                                        </td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- EVENT MODAL -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="eventForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalLabel">Add Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="eventDate">
                    <div class="mb-3">
                        <label for="eventTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="col">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" required>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <label for="startTime" class="form-label">Start Time</label>
                            <input type="time" class="form-control" id="startTime">
                        </div>
                        <div class="col">
                            <label for="endTime" class="form-label">End Time</label>
                            <input type="time" class="form-control" id="endTime">
                        </div>
                    </div>
                    <div class="form-check mt-3">
                        <input type="checkbox" class="form-check-input" id="allDay">
                        <label class="form-check-label" for="allDay">All Day</label>
                    </div>
                    <div class="form-check mt-2">
                        <input type="checkbox" class="form-check-input" id="recurring">
                        <label class="form-check-label" for="recurring">Recurring</label>
                    </div>
                    <div id="recurrenceOptions" class="mt-2 d-none">
                        <select class="form-select" id="recurrenceRule">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Event</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- INCLUDE JS -->
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
{% endblock %}